#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""shoutdctl

Multicast among containers on different hosts made easy.

Usage:
  shoutdctl start <swarm_url> [--join=<router_ip>]
  shoutdctl stop
  shoutdctl (-h | --help)
  shoutdctl (-v | --version)

Options:
  -h --help             Show this screen.
  -v --version          Show version.
  --join=<router_ip>    Shoutd router IP address
"""
from docopt import docopt
import subprocess  # Good old buddy <3


def run(command):
    subprocess.run(command.split(' '), stdout=subprocess.DEVNULL, stderr=subprocess.STDOUT)

if __name__ == '__main__':
    args = docopt(__doc__, version='shoutdctl 0.1.0')

    if args['start']:
        if args.get('--join'):
            params = '%s --join=%s' % (args['<swarm_url>'], args['--join'])
        else:
            params = args['<swarm_url>']
        run('docker run -d --name=shoutd --network=host -p 7788 -v /usr/lib/docker/plugins shoutd %s' % params)
    else:
        print('Stoping...')
        run('docker stop shoutd')
        run('docker rm shoutd')
